\hypertarget{sound_8c_source}{}\doxysection{sound.\+c}
\label{sound_8c_source}\index{arm7/source/sound.c@{arm7/source/sound.c}}
\mbox{\hyperlink{sound_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <nds/arm7/audio.h>}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <nds/ipc.h>}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <nds/fifocommon.h>}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <nds/fifomessages.h>}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <nds/system.h>}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <nds/timers.h>}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00007}00007\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{common_8h}{common.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00008}00008\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00009}00009\ \textcolor{comment}{//\ The\ lower\ this\ value,\ the\ more\ often\ sound\ will\ be\ synchronized.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00010}\mbox{\hyperlink{sound_8c_a0ea92f18bf78e0ba0c2ef6493e6ab88a}{00010}}\ \textcolor{preprocessor}{\#define\ SOUND\_RESOLUTION\ 150}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00012}00012\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_a9f16139ed89e04bbf426e98e409bf5d8}{startChannel}}(\textcolor{keywordtype}{int});}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00013}00013\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_ad8597cd63777668e6153a1ef0f48cf8e}{setChannelVolume}}(\textcolor{keywordtype}{int},\ \textcolor{keywordtype}{bool});}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00014}00014\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_a210f5cfc9927a09701d10a0668c293aa}{doCommand}}(u32);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00015}00015\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_a4ffc273b6ed9c89c1296b82e04cfd680}{updateMasterVolume}}();}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00016}00016\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_afc5d21328de513f36d016835d0a935e5}{updateChannel}}(\textcolor{keywordtype}{int},\ \textcolor{keywordtype}{bool});}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00017}00017\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_a18e3acb918b133462ef8efb03bce74d4}{setHyperSound}}(\textcolor{keywordtype}{int});}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00019}\mbox{\hyperlink{sound_8c_aa1b33e324aea9f7a55ca620c0fd4951e}{00019}}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{sound_8c_aa1b33e324aea9f7a55ca620c0fd4951e}{channels}}[4]\ =\ \{8,\ 9,\ 0,\ 14\};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00020}\mbox{\hyperlink{sound_8c_ad09d9caa46ff9c209adc53c160022dae}{00020}}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{sound_8c_ad09d9caa46ff9c209adc53c160022dae}{dutyIndex}}[4]\ =\ \{0,\ 1,\ 3,\ 5\};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00021}\mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{00021}}\ u32\ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[4];}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00022}00022\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00023}\mbox{\hyperlink{sound_8c_aedd61d10e463df5f1251e8089f554c52}{00023}}\ u8\ \mbox{\hyperlink{sound_8c_aedd61d10e463df5f1251e8089f554c52}{backgroundSample}}[16];}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00025}\mbox{\hyperlink{sound_8c_acb4572c2c7c59e6f1b9a5a076a3a7e8d}{00025}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{sound_8c_acb4572c2c7c59e6f1b9a5a076a3a7e8d}{currentLfsr}};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00027}00027\ \textcolor{comment}{//\ Use\ this\ with\ the\ 7-\/bit\ lfsr.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00028}00028\ \textcolor{comment}{//\ Note:\ On\ a\ gameboy\ it's\ 127\ samples,\ but\ on\ a\ ds,\ \#\ samples\ must\ be\ a}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00029}00029\ \textcolor{comment}{//\ multiple\ of\ 4.\ Previously\ I\ just\ repeated\ this\ 4\ times.\ But\ that\ doesn't\ work}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00030}00030\ \textcolor{comment}{//\ when\ the\ frequency\ is\ above\ 0xffff,\ apparently?\ So\ one\ extra\ byte\ is}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00031}00031\ \textcolor{comment}{//\ appended\ instead.\ (I\ still\ have\ mild\ problems\ with\ frequencies\ >0xffff.)}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00032}\mbox{\hyperlink{sound_8c_ab62e524d64b812841067f3f311bde8ab}{00032}}\ u8\ lfsr7NoiseSample[]\ \mbox{\hyperlink{sound_8c_ab62e524d64b812841067f3f311bde8ab}{ALIGN}}(4)\ =\ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00033}00033\ \ \ \ \ 0xa0,\ 0xa0,\ 0xa0,\ 0xa0,\ 0xa0,\ 0x60,\ 0xa0,\ 0xa0,\ 0xa0,\ 0xa0,\ 0xa0,\ 0x60,\ 0x60,\ 0xa0,\ 0xa0,\ 0xa0,\ 0xa0,\ 0x60,\ 0xa0,\ 0x60,\ 0xa0,\ 0xa0,\ 0xa0,\ 0x60,\ 0x60,\ 0x60,\ 0x60,\ 0xa0,\ 0xa0,\ 0x60,\ 0xa0,\ 0xa0,\ 0xa0,\ 0x60,\ 0xa0,\ 0x60,\ 0x60,\ 0xa0,\ 0xa0,\ 0x60,\ 0x60,\ 0x60,\ 0xa0,\ 0x60,\ 0xa0,\ 0x60,\ 0xa0,\ 0xa0,\ 0x60,\ 0x60,\ 0x60,\ 0x60,\ 0x60,\ 0xa0,\ 0x60,\ 0xa0,\ 0xa0,\ 0xa0,\ 0xa0,\ 0x60,\ 0x60,\ 0x60,\ 0xa0,\ 0xa0,\ 0xa0,\ 0x60,\ 0xa0,\ 0xa0,\ 0x60,\ 0xa0,\ 0xa0,\ 0x60,\ 0x60,\ 0xa0,\ 0x60,\ 0x60,\ 0xa0,\ 0x60,\ 0xa0,\ 0x60,\ 0x60,\ 0xa0,\ 0x60,\ 0x60,\ 0x60,\ 0x60,\ 0xa0,\ 0x60,\ 0x60,\ 0xa0,\ 0xa0,\ 0xa0,\ 0x60,\ 0x60,\ 0xa0,\ 0x60,\ 0xa0,\ 0xa0,\ 0x60,\ 0xa0,\ 0x60,\ 0x60,\ 0x60,\ 0xa0,\ 0x60,\ 0x60,\ 0x60,\ 0xa0,\ 0xa0,\ 0x60,\ 0x60,\ 0xa0,\ 0xa0,\ 0x60,\ 0xa0,\ 0x60,\ 0xa0,\ 0x60,\ 0xa0,\ 0x60,\ 0x60,\ 0x60,\ 0x60,\ 0x60,\ 0x60,\ 0x60,\ 0xa0,\ 0x60\};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00035}00035\ \textcolor{comment}{//\ Use\ this\ with\ the\ 15-\/bit\ lfsr.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00036}00036\ \textcolor{comment}{//\ noise.h\ is\ huge.\ Like,\ 32\ kilobytes\ of\ white\ noise.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00037}00037\ \textcolor{comment}{//\ I\ wasn't\ satisfied\ with\ the\ ds's\ noise\ channel\ in\ some\ situations,\ like\ when}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00038}00038\ \textcolor{comment}{//\ the\ maku\ tree\ disappears\ in\ Oracle\ of\ Ages.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00039}00039\ \textcolor{comment}{//\ If\ the\ arm7\ binary\ hits\ its\ size\ limit,\ this\ may\ need\ to\ be\ reworked.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00040}00040\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{noise_8h}{noise.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00042}\mbox{\hyperlink{sound_8c_a210f5cfc9927a09701d10a0668c293aa}{00042}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_a210f5cfc9927a09701d10a0668c293aa}{doCommand}}(u32\ command)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00043}00043\ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00044}00044\ \ \ \ \ \textcolor{keywordtype}{int}\ cmd\ =\ (command\ >>\ 20)\ \&\ 0xf;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00045}00045\ \ \ \ \ \textcolor{keywordtype}{int}\ data\ =\ command\ \&\ 0xFFFF;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00046}00046\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00047}00047\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00048}00048\ \ \ \ \ \textcolor{keywordflow}{switch}\ (cmd)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00049}00049\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00050}00050\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00051}00051\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{common_8h_a16af7b253440dadd46a80a4b9fddba4da728a02468e0f9fc5117ec4051f61c6bb}{GBSND\_UPDATE\_COMMAND}}:}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00052}00052\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (data\ ==\ 4)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00053}00053\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ 4;\ i++)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_afc5d21328de513f36d016835d0a935e5}{updateChannel}}(i,\ \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00058}00058\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00059}00059\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00060}00060\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_afc5d21328de513f36d016835d0a935e5}{updateChannel}}(data,\ \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00061}00061\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00063}00063\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{common_8h_a16af7b253440dadd46a80a4b9fddba4da1e083155fe2dd9ea1eefa5cfd3de50dc}{GBSND\_START\_COMMAND}}:}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00064}00064\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a9f16139ed89e04bbf426e98e409bf5d8}{startChannel}}(data);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00065}00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00066}00066\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00067}00067\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{common_8h_a16af7b253440dadd46a80a4b9fddba4da109a8aa28daacd354c41dc6764ad7e00}{GBSND\_VOLUME\_COMMAND}}:}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00068}00068\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_ad8597cd63777668e6153a1ef0f48cf8e}{setChannelVolume}}(data,\ \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00069}00069\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00070}00070\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00071}00071\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{common_8h_a16af7b253440dadd46a80a4b9fddba4da2b3f05a4638c05afad03242c0e376ea2}{GBSND\_MASTER\_VOLUME\_COMMAND}}:}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00072}00072\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a4ffc273b6ed9c89c1296b82e04cfd680}{updateMasterVolume}}();}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00073}00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00075}00075\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{common_8h_a16af7b253440dadd46a80a4b9fddba4dac9ab7848143c25d0e2d6b3270a9d6da9}{GBSND\_KILL\_COMMAND}}:}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00076}00076\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ SCHANNEL\_CR(channel)\ \&=\ \string~SCHANNEL\_ENABLE;}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00077}00077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00079}00079\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{common_8h_a16af7b253440dadd46a80a4b9fddba4da53c6d107a23f87bbbb93f4ef2b1848fb}{GBSND\_MUTE\_COMMAND}}:}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00080}00080\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ does\ not\ touch\ the\ "{}background\ hum"{}\ to\ prevent\ clicking.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00081}00081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ 4;\ i++)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00082}00082\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ SCHANNEL\_CR(\mbox{\hyperlink{sound_8c_aa1b33e324aea9f7a55ca620c0fd4951e}{channels}}[i])\ \&=\ \string~0x7f;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00084}00084\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00085}00085\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00086}00086\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00087}00087\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{common_8h_a16af7b253440dadd46a80a4b9fddba4da0af37510ab11b9a45cf5dc6d5a550d03}{GBSND\_UNMUTE\_COMMAND}}:}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00088}00088\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ 4;\ i++)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00089}00089\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_af5b7afec609c180e9d03dc87a9ce59ce}{chanOn}}\ \&\ (1\ <<\ i))\ \&\&\ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_aeb33df75b64eb91d40147ece8def08a0}{chanEnabled}}[i])}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_ad8597cd63777668e6153a1ef0f48cf8e}{setChannelVolume}}(i,\ \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00092}00092\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00093}00093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00094}00094\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00095}00095\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{common_8h_a16af7b253440dadd46a80a4b9fddba4da299fe28ebaf57d5d2b2150cbdb086c5d}{GBSND\_HYPERSOUND\_ENABLE\_COMMAND}}:}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00096}00096\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a18e3acb918b133462ef8efb03bce74d4}{setHyperSound}}(data);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00097}00097\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00098}00098\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00099}00099\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00100}00100\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00101}00101\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00102}00102\ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00104}00104\ \textcolor{comment}{//\ Callback\ for\ hyperSound\ /\ Sound\ Fix,\ which\ works\ with\ arm9\ to\ synchronize}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00105}00105\ \textcolor{comment}{//\ sound\ to\ the\ cycle.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00106}\mbox{\hyperlink{sound_8c_ae61918cb73b50984d9baf24e19c3db4d}{00106}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_ae61918cb73b50984d9baf24e19c3db4d}{timerCallback}}()}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00107}00107\ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00108}00108\ \ \ \ \ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a03170f2fb237b34a50174fedc41679c1}{dsCycles}}\ +=\ \mbox{\hyperlink{sound_8c_a0ea92f18bf78e0ba0c2ef6493e6ab88a}{SOUND\_RESOLUTION}};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00109}00109\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a40eebec5b7b5809ca80882aa2cb4fdf5}{cycles}}\ !=\ -\/1)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00110}00110\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00111}00111\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ doit\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00112}00112\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a375385b4dc726b4c0edae7a2b438ce48}{frameFlip\_Gameboy}}\ ==\ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_afed8946bd180371ec758e171fabdb7ca}{frameFlip\_DS}})}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00113}00113\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a03170f2fb237b34a50174fedc41679c1}{dsCycles}}\ >=\ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a40eebec5b7b5809ca80882aa2cb4fdf5}{cycles}})}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ doit\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00116}00116\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00117}00117\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00118}00118\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00119}00119\ \ \ \ \ \ \ \ \ \ \ \ \ doit\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00120}00120\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00121}00121\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (doit)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00122}00122\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00123}00123\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a40eebec5b7b5809ca80882aa2cb4fdf5}{cycles}}\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a210f5cfc9927a09701d10a0668c293aa}{doCommand}}(\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_aa8d0c908d751e0355e64e00dba2108d5}{message}});}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00125}00125\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00126}00126\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00127}00127\ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00128}00128\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00129}\mbox{\hyperlink{sound_8c_ad8597cd63777668e6153a1ef0f48cf8e}{00129}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_ad8597cd63777668e6153a1ef0f48cf8e}{setChannelVolume}}(\textcolor{keywordtype}{int}\ c,\ \textcolor{keywordtype}{bool}\ write)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00130}00130\ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00131}00131\ \ \ \ \ \textcolor{keywordtype}{int}\ channel\ =\ \mbox{\hyperlink{sound_8c_aa1b33e324aea9f7a55ca620c0fd4951e}{channels}}[c];}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00132}00132\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00133}00133\ \ \ \ \ \textcolor{keywordtype}{int}\ volume\ =\ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_ac605d4c380c0f0552376a2521894870a}{chanRealVol}}[c]\ *\ 2;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00134}00134\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a5d8f6fd81997d4bf2e51d2b6a700e30b}{chanPan}}[c]\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00135}00135\ \ \ \ \ \ \ \ \ volume\ =\ 0;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00136}00136\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a5d8f6fd81997d4bf2e51d2b6a700e30b}{chanPan}}[c]\ ==\ 64)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00137}00137\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00138}00138\ \ \ \ \ \ \ \ \ volume\ *=\ 2;\ \textcolor{comment}{//\ DS\ divides\ sound\ by\ 2\ for\ each\ speaker;\ gameboy\ doesn't}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00139}00139\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00140}00140\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00141}00141\ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ \&=\ \string~0x7f;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00142}00142\ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ |=\ volume;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00143}00143\ \ \ \ \ \textcolor{keywordflow}{if}\ (write)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00144}00144\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00145}00145\ \ \ \ \ \ \ \ \ SCHANNEL\_CR(channel)\ \&=\ \string~0x7f;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00146}00146\ \ \ \ \ \ \ \ \ SCHANNEL\_CR(channel)\ |=\ volume;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00147}00147\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00148}00148\ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00149}00149\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00150}\mbox{\hyperlink{sound_8c_a9f16139ed89e04bbf426e98e409bf5d8}{00150}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_a9f16139ed89e04bbf426e98e409bf5d8}{startChannel}}(\textcolor{keywordtype}{int}\ c)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00151}00151\ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00152}00152\ \ \ \ \ \textcolor{keywordtype}{int}\ channel\ =\ \mbox{\hyperlink{sound_8c_aa1b33e324aea9f7a55ca620c0fd4951e}{channels}}[c];}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00153}00153\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00154}00154\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_aeb33df75b64eb91d40147ece8def08a0}{chanEnabled}}[c])}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00155}00155\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00156}00156\ \ \ \ \ \ \ \ \ SCHANNEL\_CR(channel)\ =\ 0;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00157}00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00158}00158\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00159}00159\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00160}00160\ \ \ \ \ \textcolor{keywordflow}{if}\ (c\ ==\ 2)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00161}00161\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00162}00162\ \ \ \ \ \ \ \ \ SCHANNEL\_SOURCE(channel)\ =\ (u32)\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a127281bde836c9c2fb579261ddbe53e7}{sampleData}};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00163}00163\ \ \ \ \ \ \ \ \ SCHANNEL\_REPEAT\_POINT(channel)\ =\ 0;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00164}00164\ \ \ \ \ \ \ \ \ SCHANNEL\_LENGTH(channel)\ =\ 0x20\ >>\ 2;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00165}00165\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ =\ (0\ <<\ 29)\ |\ SOUND\_REPEAT;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00166}00166\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00167}00167\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (c\ ==\ 3)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00168}00168\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00169}00169\ \ \ \ \ \ \ \ \ SCHANNEL\_CR(channel)\ =\ 0;\ \textcolor{comment}{//\ Why\ does\ this\ help?\ It\ seems\ to\ make\ other\ channels\ worse.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00170}00170\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00171}00171\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_acb4572c2c7c59e6f1b9a5a076a3a7e8d}{currentLfsr}}\ =\ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a8b33d9df4ca68bf18116d475ee8eefec}{lfsr7Bit}};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00172}00172\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a8b33d9df4ca68bf18116d475ee8eefec}{lfsr7Bit}})}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00173}00173\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \ \ \ SCHANNEL\_SOURCE(channel)\ =\ (u32)lfsr7NoiseSample;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \ \ \ SCHANNEL\_LENGTH(channel)\ =\ 128\ >>\ 2;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00176}00176\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00177}00177\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00178}00178\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \ \ \ SCHANNEL\_SOURCE(channel)\ =\ (u32)lfsr15NoiseSample;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00180}00180\ \ \ \ \ \ \ \ \ \ \ \ \ SCHANNEL\_LENGTH(channel)\ =\ 32768\ >>\ 2;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00181}00181\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00182}00182\ \ \ \ \ \ \ \ \ SCHANNEL\_REPEAT\_POINT(channel)\ =\ 0;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00183}00183\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ =\ (0\ <<\ 29)\ |\ SOUND\_REPEAT;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00184}00184\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00185}00185\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00186}00186\ \ \ \ \ \{\ \textcolor{comment}{//\ PSG\ channels}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00187}00187\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ =\ (3\ <<\ 29);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00188}00188\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00189}00189\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00190}00190\ \ \ \ \ \mbox{\hyperlink{sound_8c_afc5d21328de513f36d016835d0a935e5}{updateChannel}}(c,\ \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00191}00191\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00192}00192\ \ \ \ \ SCHANNEL\_CR(channel)\ =\ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ |\ SCHANNEL\_ENABLE;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00193}00193\ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00194}00194\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00195}\mbox{\hyperlink{sound_8c_afc5d21328de513f36d016835d0a935e5}{00195}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_afc5d21328de513f36d016835d0a935e5}{updateChannel}}(\textcolor{keywordtype}{int}\ c,\ \textcolor{keywordtype}{bool}\ write)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00196}00196\ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00197}00197\ \ \ \ \ \textcolor{keywordtype}{int}\ channel\ =\ \mbox{\hyperlink{sound_8c_aa1b33e324aea9f7a55ca620c0fd4951e}{channels}}[c];}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00198}00198\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00199}00199\ \ \ \ \ \textcolor{keywordflow}{if}\ (!(\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_af5b7afec609c180e9d03dc87a9ce59ce}{chanOn}}\ \&\ (1\ <<\ c))\ ||\ !\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_aeb33df75b64eb91d40147ece8def08a0}{chanEnabled}}[c])}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00200}00200\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00201}00201\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ \&=\ \string~0x7f;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00202}00202\ \ \ \ \ \ \ \ \ SCHANNEL\_CR(channel)\ \&=\ \string~0x7f;\ \textcolor{comment}{//\ Set\ volume\ to\ zero}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00203}00203\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00204}00204\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00205}00205\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00206}00206\ \ \ \ \ SCHANNEL\_TIMER(channel)\ =\ SOUND\_FREQ(\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a6e18f86fe6c9136a69a01e8b638b5ea6}{chanRealFreq}}[c]);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00207}00207\ \ \ \ \ \textcolor{keywordflow}{if}\ (c\ <\ 2)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00208}00208\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00209}00209\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ \&=\ \string~(SOUND\_PAN(127)\ |\ 7\ <<\ 24);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00210}00210\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ |=\ SOUND\_PAN(\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a5d8f6fd81997d4bf2e51d2b6a700e30b}{chanPan}}[c])\ |\ (\mbox{\hyperlink{sound_8c_ad09d9caa46ff9c209adc53c160022dae}{dutyIndex}}[\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_adb89a1853d13d754ccc79720b6898909}{chanDuty}}[c]]\ <<\ 24);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00211}00211\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00212}00212\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (c\ ==\ 2)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00213}00213\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00214}00214\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ \&=\ \string~(SOUND\_PAN(127));}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00215}00215\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ |=\ SOUND\_PAN(\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a5d8f6fd81997d4bf2e51d2b6a700e30b}{chanPan}}[c]);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00216}00216\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00217}00217\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (c\ ==\ 3)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00218}00218\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00219}00219\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{sound_8c_acb4572c2c7c59e6f1b9a5a076a3a7e8d}{currentLfsr}}\ !=\ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a8b33d9df4ca68bf18116d475ee8eefec}{lfsr7Bit}})}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00220}00220\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a9f16139ed89e04bbf426e98e409bf5d8}{startChannel}}(c);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00221}00221\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ \&=\ \string~(SOUND\_PAN(127));}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00222}00222\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ |=\ SOUND\_PAN(\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a5d8f6fd81997d4bf2e51d2b6a700e30b}{chanPan}}[c]);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00223}00223\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00224}00224\ \ \ \ \ \textcolor{keywordflow}{if}\ (write)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00225}00225\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00226}00226\ \ \ \ \ \ \ \ \ SCHANNEL\_CR(channel)\ \&=\ \string~(SOUND\_PAN(127)\ |\ 7\ <<\ 24);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00227}00227\ \ \ \ \ \ \ \ \ SCHANNEL\_CR(channel)\ |=\ (\mbox{\hyperlink{sound_8c_a78a757c15ca6c9644374960b8ea64c4f}{schannelCR}}[c]\ \&\ (SOUND\_PAN(127)\ |\ 7\ <<\ 24));}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00228}00228\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00229}00229\ \ \ \ \ \mbox{\hyperlink{sound_8c_ad8597cd63777668e6153a1ef0f48cf8e}{setChannelVolume}}(c,\ write);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00230}00230\ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00231}00231\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00232}\mbox{\hyperlink{sound_8c_a4ffc273b6ed9c89c1296b82e04cfd680}{00232}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_a4ffc273b6ed9c89c1296b82e04cfd680}{updateMasterVolume}}()}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00233}00233\ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00234}00234\ \ \ \ \ \textcolor{comment}{//\ TODO:\ when\ SO1Vol\ !=\ SO2Vol}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00235}00235\ \ \ \ \ \textcolor{keywordtype}{int}\ SO1Vol\ =\ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_af236d9c76a4a381e084c31147d098b64}{volControl}}\ \&\ 7;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00236}00236\ \ \ \ \ \textcolor{keywordflow}{if}\ (SO1Vol\ *\ 18\ !=\ (REG\_SOUNDCNT\ \&\ 0x7f))}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00237}00237\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00238}00238\ \ \ \ \ \ \ \ \ REG\_SOUNDCNT\ \&=\ \string~0x7f;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00239}00239\ \ \ \ \ \ \ \ \ REG\_SOUNDCNT\ |=\ SO1Vol\ *\ 18;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00240}00240\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00241}00241\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00242}00242\ \ \ \ \ \textcolor{comment}{//\ Each\ sound\ channel\ enabled\ in\ NR51\ adds\ a\ bit\ of\ a\ "{}background\ tone"{}.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00243}00243\ \ \ \ \ \textcolor{comment}{//\ I'm\ not\ really\ sure\ if\ this\ behaviour\ is\ correct.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00244}00244\ \ \ \ \ \textcolor{comment}{//\ I'm\ trying\ to\ strike\ a\ balance\ between\ the\ "{}Warlocked/Perfect\ Dark/Alone}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00245}00245\ \ \ \ \ \textcolor{comment}{//\ in\ the\ Dark"{}\ sound\ effects,\ and\ the\ annoying\ clicking\ in\ some\ games.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00246}00246\ \ \ \ \ \textcolor{keywordtype}{int}\ vol\ =\ 0;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00247}00247\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00248}00248\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ 4;\ i++)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00249}00249\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00250}00250\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_ad17b2ef59c3309fdb7e6ec80575dae5c}{chanOutput}}\ \&\ ((1\ <<\ i)\ |\ (1\ <<\ (i\ +\ 4))))}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00251}00251\ \ \ \ \ \ \ \ \ \ \ \ \ vol\ +=\ 0x20;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00252}00252\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00253}00253\ \ \ \ \ \textcolor{keywordflow}{if}\ (vol\ ==\ 0x80)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00254}00254\ \ \ \ \ \ \ \ \ vol\ =\ 0x7f;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00255}00255\ \ \ \ \ SCHANNEL\_CR(1)\ \&=\ \string~0x7f;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00256}00256\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_ad17b2ef59c3309fdb7e6ec80575dae5c}{chanOutput}})}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00257}00257\ \ \ \ \ \ \ \ \ SCHANNEL\_CR(1)\ |=\ vol;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00258}00258\ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00259}00259\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00260}\mbox{\hyperlink{sound_8c_a18e3acb918b133462ef8efb03bce74d4}{00260}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_a18e3acb918b133462ef8efb03bce74d4}{setHyperSound}}(\textcolor{keywordtype}{int}\ enabled)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00261}00261\ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00262}00262\ \ \ \ \ \textcolor{keywordflow}{if}\ (enabled)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00263}00263\ \ \ \ \ \ \ \ \ timerStart(1,\ ClockDivider\_1,\ TIMER\_FREQ(4194304\ /\ \mbox{\hyperlink{sound_8c_a0ea92f18bf78e0ba0c2ef6493e6ab88a}{SOUND\_RESOLUTION}}),\ \mbox{\hyperlink{sound_8c_ae61918cb73b50984d9baf24e19c3db4d}{timerCallback}});}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00264}00264\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00265}00265\ \ \ \ \ \ \ \ \ timerStop(1);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00266}00266\ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00267}00267\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00268}\mbox{\hyperlink{sound_8c_a2517bf8a5f352cd5aa55c71564341f8b}{00268}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_a2517bf8a5f352cd5aa55c71564341f8b}{gameboySoundCommandHandler}}(u32\ command,\ \textcolor{keywordtype}{void}\ *userdata)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00269}00269\ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00270}00270\ \ \ \ \ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a9908c044a6a457f71fabb131e8621151}{fifosReceived}}++;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00271}00271\ \ \ \ \ \mbox{\hyperlink{sound_8c_a210f5cfc9927a09701d10a0668c293aa}{doCommand}}(command);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00272}00272\ \}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00273}00273\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00274}\mbox{\hyperlink{main_8c_a8acfbecedff5019a4fa42da181423441}{00274}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{sound_8c_a8acfbecedff5019a4fa42da181423441}{installGameboySoundFIFO}}()}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00275}00275\ \{}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00276}00276\ \ \ \ \ fifoSetValue32Handler(FIFO\_USER\_01,\ \mbox{\hyperlink{sound_8c_a2517bf8a5f352cd5aa55c71564341f8b}{gameboySoundCommandHandler}},\ 0);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00277}00277\ \ \ \ \ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a40eebec5b7b5809ca80882aa2cb4fdf5}{cycles}}\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00278}00278\ \ \ \ \ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a47b59e2df77853e1827c4b6d990c0e67}{fifosSent}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00279}00279\ \ \ \ \ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a9908c044a6a457f71fabb131e8621151}{fifosReceived}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00280}00280\ \ \ \ \ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_afed8946bd180371ec758e171fabdb7ca}{frameFlip\_DS}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00281}00281\ \ \ \ \ \mbox{\hyperlink{main_8c_a2bb32c52cb5d21be737aaa2aefb353d4}{sharedData}}-\/>\mbox{\hyperlink{struct_shared_data_a375385b4dc726b4c0edae7a2b438ce48}{frameFlip\_Gameboy}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00282}00282\ \ \ \ \ \mbox{\hyperlink{sound_8c_a18e3acb918b133462ef8efb03bce74d4}{setHyperSound}}(1);}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00283}00283\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00284}00284\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00285}00285\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ 16;\ i++)}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00286}00286\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sound_8c_aedd61d10e463df5f1251e8089f554c52}{backgroundSample}}[i]\ =\ 0x7f;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00287}00287\ }
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00288}00288\ \ \ \ \ \textcolor{comment}{//\ The\ gameboy\ produces\ a\ sort\ of\ background\ "{}hum"{}.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00289}00289\ \ \ \ \ \textcolor{comment}{//\ By\ simply\ existing,\ this\ allows\ for\ games\ to\ adjust\ global\ volume\ to\ make}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00290}00290\ \ \ \ \ \textcolor{comment}{//\ certain\ complex\ sound\ effects\ -\/\ even\ when\ all\ other\ channels\ are\ muted.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00291}00291\ \ \ \ \ \textcolor{comment}{//\ Eg.\ Warlocked,\ Perfect\ Dark.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00292}00292\ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ cause\ of\ "{}clicking"{}\ in\ certain\ games.\ It\ exists\ to\ an\ extent}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00293}00293\ \ \ \ \ \textcolor{comment}{//\ on\ real\ gameboys\ as\ well.}}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00294}00294\ \ \ \ \ SCHANNEL\_SOURCE(1)\ =\ (u32)\mbox{\hyperlink{sound_8c_aedd61d10e463df5f1251e8089f554c52}{backgroundSample}};}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00295}00295\ \ \ \ \ SCHANNEL\_REPEAT\_POINT(1)\ =\ 0;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00296}00296\ \ \ \ \ SCHANNEL\_LENGTH(1)\ =\ 16\ >>\ 2;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00297}00297\ \ \ \ \ SCHANNEL\_CR(1)\ =\ SCHANNEL\_ENABLE\ |\ SOUND\_VOL(0)\ |}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00298}00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SOUND\_PAN(64)\ |\ (0\ <<\ 29)\ |\ SOUND\_REPEAT;}
\DoxyCodeLine{\Hypertarget{sound_8c_source_l00299}00299\ \}}

\end{DoxyCode}
